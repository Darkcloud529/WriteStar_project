<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="com.writestar.mapper.BoardMapper"> 
 	<resultMap type="com.writestar.domain.UserVO" id="userInfo">
		<result column="email" property="email"/>
		<result column="password" property="password"/>
		<result column="nickname" property="nickname"/>
		<result column="user_info" property="user_info"/>
	</resultMap>
	
	<resultMap type="com.writestar.domain.BoardVO" id="boardVo">
		<result column="bno" property="bno"/>
		<result column="title" property="title"/>
		<result column="content" property="content"/>
		<result column="regdate" property="regdate"/>
		<result column="address" property="address"/>
		<result column="post_type" property="post_type"/>
		<result column="email" property="email"/>
		<collection property="userVO" resultMap="userInfo" />
	</resultMap>
	
	 <select id="getList" resultType="com.writestar.domain.BoardVO">
	 	<![CDATA[
	 		select * from tbl_board where bno >0
	 	]]>
	 </select>
	 
	 <!-- 검색을 위해 동적 sql 처리 -->
	 <select id="getListWithPaging" resultMap="boardVo">
	 	<![CDATA[
		 	select
		 		bno, title, content, regdate, address, post_type, email, nickname
		 	from
		 	(
		 		select /*+INDEX_DESC(tbl_board, pk_board) */
				       rownum as rn,
				       b.bno as bno,
				       b.title as title,
				       b.content as content,
				       b.regdate as regdate,
				       b.address as address,
				       b.post_type as post_type,
				       b.email as email,
				       a.nickname as nickname
		 		  from tbl_user a, tbl_board b
		 		 where a.email = b.email
	 	]]>
	 	<![CDATA[
	 		       and rownum <= #{pageNum} * #{amount}
	 	    )
	 	    where rn > (#{pageNum} -1) * #{amount} 			
	 	]]>
	 </select>
	 
	 <insert id="insert">
	 	insert
	 	into tbl_board ( bno,
 						title,
 						content,
						regdate,
						address,
						post_type,
						email )
	 	values ( #{bno}, 
	 			 #{title}, 
	 			 #{content}, 
	 			 sysdate, 
	 			 #{address}, 
	 			 #{post_type}, 
	 			 #{email})
	 </insert>
	 
	 <insert id="insertSelectKey">
	 	<selectKey keyProperty="bno" order="BEFORE" resultType="long">
	 		select seq_board.nextval from dual
	 	</selectKey>
	 	insert
	 	into tbl_board ( bno,
 						title,
 						content,
						regdate,
						address,
						post_type,
						email )
	 	values ( #{bno}, 
	 			 #{title}, 
	 			 #{content}, 
	 			 sysdate, 
	 			 #{address}, 
	 			 #{post_type}, 
	 			 #{email})
	 </insert>
	 
	 <select id="read" resultType="com.writestar.domain.BoardVO">
	 	select bno,
	 		   title,
	 		   content, 
	 		   regdate, 
	 		   address, 
	 		   post_type, 
	 		   email
	 	  from tbl_board
	 	 where bno = #{bno}
	 </select>
	 
	 <delete id="delete">
	 	delete from tbl_board where bno = #{bno}
	 </delete>
	 
	 <update id="update">
	 	update tbl_board set title=#{title}, content=#{content}, address=#{address},
	 	post_type=#{post_type}, email=#{email} where bno = ${bno}
	 </update>
	 
	 <select id="getTotalCount" resultType="int">
	 	select count(*) from tbl_board 
	 	where

	 	 bno >0
	 </select>
	</mapper>